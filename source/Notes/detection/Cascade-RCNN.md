# Cascade-RCNN

**标题：** Cascade R-CNN: Delving into High Quality Object Detection

**作者：** Zhaowei Cai, Nuno Vasconcelos (UC San Diego)

**摘要：**
这篇论文提出了一种新的多阶段目标检测架构——Cascade R-CNN，旨在解决目标检测中的质量问题，特别是在高IoU阈值下的性能下降问题。该架构通过一系列逐步增加IoU阈值的检测器来提高检测质量，每个检测器都在前一个检测器的基础上进行训练，以更精确地排除接近的误报。

**1. 问题：**
论文试图解决目标检测中的质量问题，特别是在使用较高的IoU（交并比）阈值时，目标检测器的性能会下降的问题。

**2. 新问题：**
是的，这是一个新问题。尽管目标检测器的性能在IoU阈值较低时已经得到了很好的研究，但在高IoU阈值下如何保持高质量检测是一个较新的问题。

**3. 科学假设：**
假设通过使用多阶段的检测器，每个阶段都比前一个阶段对接近的误报更具有选择性，可以提高目标检测的质量。

**4. 相关研究：**
- 两阶段检测器（如R-CNN, Fast R-CNN, Faster R-CNN）
- 单阶段检测器（如YOLO, SSD）
- 多阶段检测方法（如RetinaNet）
- 目标检测中的IoU优化问题
- 领域内值得关注的研究员包括但不限于：Kaiming He, Ross Girshick, Shaoqing Ren等。

**5. 解决方案关键：**
- 多阶段检测架构，逐步增加IoU阈值。
- 利用前一阶段的输出作为训练下一阶段高质量检测器的样本。
- 在推理时应用相同的级联过程，以提高检测精度。

**6. 实验设计：**
- 使用COCO数据集进行训练和验证。
- 对比Cascade R-CNN与单模型目标检测器的性能。
- 实验包括不同基线检测器（如Faster R-CNN, R-FCN, FPN）上的Cascade R-CNN架构。

**7. 数据集与代码：**
- 使用的数据集是MS-COCO 2017。
- 代码将在GitHub上开源：https://github.com/zhaoweicai/cascade-rcnn。

**8. 实验结果：**
实验结果表明，Cascade R-CNN在COCO数据集上的表现超过了所有单模型目标检测器，特别是在更高的质量评估指标下。

**9. 论文贡献：**
- 提出了一种新的多阶段目标检测架构，能够在高IoU阈值下提高检测质量。
- 证明了该架构可以广泛应用于不同的目标检测器架构，并取得了一致的性能提升。
- 实验验证了该方法在目标检测任务中的有效性，特别是在需要高准确度的场景中。

**10. 下一步工作：**
- 进一步探索Cascade R-CNN在不同领域和任务中的应用。
- 研究如何减少计算成本，使其更适合实时或资源受限的环境。
- 结合其他先进的目标检测技术，如分割网络，以进一步提升性能。

回答问题

1. **问题：** 目标检测中的高IoU阈值下性能下降问题。
2. **新问题：** 是的，特别是在高IoU阈值下保持检测质量是一个较新的问题。
3. **科学假设：** 通过多阶段选择性检测器可以提高目标检测质量。
4. **相关研究：** 包括两阶段和单阶段检测器的研究，以及多阶段检测方法。值得关注的研究员包括Kaiming He, Ross Girshick, Shaoqing Ren等。
5. **解决方案关键：** 多阶段架构和逐步增加的IoU阈值。
6. **实验设计：** 使用COCO数据集，对比Cascade R-CNN与单模型检测器。
7. **数据集与代码：** MS-COCO 2017数据集，代码将开源。
8. **实验结果：** 支持假设，Cascade R-CNN在高IoU阈值下表现更好。
9. **论文贡献：** 提出了一种新的多阶段检测架构，提升了目标检测质量，特别是高IoU阈值下。
10. **下一步工作：** 探索Cascade R-CNN在其他任务和领域的应用，减少计算成本，结合其他先进技术提升性能。

---
<img width="724" alt="cascade-rcnn-fig1" src="https://github.com/isLinXu/issues/assets/59380685/74cfed3a-f5e7-4263-a535-1d676d5dbe50">

这个图表展示了不同IoU（Intersection over Union）阈值对目标检测器性能的影响。图表分为四个部分：

1. **(a) Detection of u = 0.5**：左上角的图像显示了在IoU阈值为0.5时的目标检测结果。图中用蓝色边框标出了检测到的目标，并显示了每个目标的置信度分数。

2. **(b) Detection of u = 0.7**：右上角的图像显示了在IoU阈值为0.7时的目标检测结果。与左图类似，目标用蓝色边框标出，并显示了置信度分数。

3. **(c) Regressor**：左下角的图表展示了不同IoU阈值（u=0.5, u=0.6, u=0.7）下的定位性能。横轴是输入的IoU，纵轴是输出的IoU。可以看到，随着IoU阈值的增加，定位性能有所提升。

4. **(d) Detector**：右下角的图表展示了不同IoU阈值下的检测性能。横轴是IoU阈值，纵轴是平均精度（AP）。可以看到，随着IoU阈值的增加，平均精度有所下降。

总结：
- 在较低的IoU阈值（如0.5）下，检测器能够检测到更多的目标，但可能会包含更多的误检。
- 在较高的IoU阈值（如0.7）下，检测器的定位精度更高，但检测到的目标数量可能会减少。
- 不同的IoU阈值对检测器的定位性能和检测性能有不同的影响，需要根据具体应用场景选择合适的IoU阈值。


---
<img width="695" alt="cascade-rcnn-fig2" src="https://github.com/isLinXu/issues/assets/59380685/f9f5c82b-2c10-4541-8966-f760e9bf6bc4">

这个图表展示了在不同级联阶段下，目标检测器的Δ分布（未归一化），并且标出了使用增加的IoU阈值时的异常值。图表分为六个部分，每个部分展示了不同级联阶段的Δ分布情况。

图表分析：

1. **上排图表（未去除异常值）**：
   - **1st stage**：第一个级联阶段的Δ分布。蓝色点表示正常值，红色点表示异常值。可以看到，异常值分布在整个图表中。
   - **2nd stage**：第二个级联阶段的Δ分布。异常值（红色点）比第一个阶段有所减少，但仍然存在。
   - **3rd stage**：第三个级联阶段的Δ分布。异常值进一步减少，分布更加集中。

2. **下排图表（去除异常值后）**：
   - **1st stage**：第一个级联阶段去除异常值后的Δ分布。可以看到，去除异常值后，分布更加集中。
   - **2nd stage**：第二个级联阶段去除异常值后的Δ分布。分布进一步集中。
   - **3rd stage**：第三个级联阶段去除异常值后的Δ分布。分布最为集中。

统计数据：
每个图表的左下角提供了统计数据，包括均值（μ）和标准差（σ）：
- **1st stage**：
  - 未去除异常值：μx = 0.0024, σx = 0.1274, μy = 0.0001, σy = 0.1287
  - 去除异常值：μx = 0.0016, σx = 0.0916, μy = 0.0001, σy = 0.0922
- **2nd stage**：
  - 未去除异常值：μx = 0.0048, σx = 0.1222, μy = 0.0012, σy = 0.1230
  - 去除异常值：μx = -0.0007, σx = 0.0773, μy = 0.0012, σy = 0.0777
- **3rd stage**：
  - 未去除异常值：μx = 0.0022, σx = 0.1187, μy = 0.0013, σy = 0.1196
  - 去除异常值：μx = 0.0001, σx = 0.0367, μy = 0.0001, σy = 0.0376

总结：
- 随着级联阶段的增加，Δ分布中的异常值逐渐减少，分布变得更加集中。
- 去除异常值后，Δ分布的均值和标准差都显著降低，表明去除异常值有助于提高检测器的稳定性和精度。
- 不同级联阶段的Δ分布统计数据表明，随着级联阶段的增加，检测器的性能逐渐提高。


---
<img width="1400" alt="cascade-rcnn-fig3" src="https://github.com/isLinXu/issues/assets/59380685/d532f590-8c73-4a8e-970f-b36794b34030">

这个图表展示了四种不同目标检测框架的架构：Faster R-CNN、Iterative BBox at inference、Integral Loss 和 Cascade R-CNN。每个框架的架构都通过不同的模块和连接方式来实现目标检测。图表分为四个部分，每个部分展示了一个框架的架构。

图表结构分析：

1. **(a) Faster R-CNN**：
    
    - **I**：输入图像。
    - **conv**：主干卷积层，用于提取特征。
    - **pool**：区域级特征提取。
    - **H**：网络头部。
    - **B0**：候选框生成。
    - **C1**：分类模块。
    - **B1**：边界框回归模块。
2. **(b) Iterative BBox at inference**：
    
    - **I**：输入图像。
    - **conv**：主干卷积层。
    - **pool**：区域级特征提取。
    - **H**：网络头部。
    - **B0**：候选框生成。
    - **C1**：分类模块。
    - **B1**：边界框回归模块。
    - **B2**：第二次边界框回归模块。
    - **C2**：第二次分类模块。
3. **(c) Integral Loss**：
    
    - **I**：输入图像。
    - **conv**：主干卷积层。
    - **pool**：区域级特征提取。
    - **H**：网络头部。
    - **B0**：候选框生成。
    - **C1**：分类模块。
    - **B1**：边界框回归模块。
    - **C2**：第二次分类模块。
    - **B2**：第二次边界框回归模块。
    - **C3**：第三次分类模块。
    - **B3**：第三次边界框回归模块。
4. **(d) Cascade R-CNN**：
    
    - **I**：输入图像。
    - **conv**：主干卷积层。
    - **pool**：区域级特征提取。
    - **H**：网络头部。
    - **B0**：候选框生成。
    - **C1**：分类模块。
    - **B1**：边界框回归模块。
    - **C2**：第二次分类模块。
    - **B2**：第二次边界框回归模块。
    - **C3**：第三次分类模块。
    - **B3**：第三次边界框回归模块。

总结：

- **Faster R-CNN**：这是一个基础的目标检测框架，包含输入图像、主干卷积层、区域级特征提取、网络头部、候选框生成、分类模块和边界框回归模块。
- **Iterative BBox at inference**：在Faster R-CNN的基础上，增加了一个迭代的边界框回归和分类模块，以提高检测精度。
- **Integral Loss**：进一步增加了更多的迭代边界框回归和分类模块，以进一步提高检测精度。
- **Cascade R-CNN**：类似于Integral Loss，但更强调级联结构，通过多次迭代的边界框回归和分类模块来逐步提高检测精度。

这些架构展示了从基础到复杂的目标检测框架的演变，每个框架都在前一个框架的基础上增加了更多的模块，以提高检测的精度和鲁棒性。


---
<img width="701" alt="cascade-rcnn-fig4" src="https://github.com/isLinXu/issues/assets/59380685/d4e5ca44-a547-4d18-b0ca-a64a38a13ed1">

这个图表展示了训练样本的IoU（Intersection over Union）直方图，分为三个级联阶段。每个阶段的直方图显示了不同IoU阈值下的样本分布情况。红色数字表示高于相应IoU阈值的正样本百分比。

图表结构分析：

1. **1st stage**：
    
    - 横轴：IoU值，从0.5到1.0。
    - 纵轴：样本数量（对数刻度）。
    - 直方图显示了第一个级联阶段的IoU分布，这是RPN（Region Proposal Network）的输出。
    - 红色数字表示高于相应IoU阈值的正样本百分比：0.5（30.0%）、0.6（20.5%）、0.7（12.1%）。
2. **2nd stage**：
    
    - 横轴：IoU值，从0.5到1.0。
    - 纵轴：样本数量（对数刻度）。
    - 直方图显示了第二个级联阶段的IoU分布。
    - 红色数字表示高于相应IoU阈值的正样本百分比：0.6（17.3%）、0.7（11.7%）、0.8（7.4%）。
3. **3rd stage**：
    
    - 横轴：IoU值，从0.5到1.0。
    - 纵轴：样本数量（对数刻度）。
    - 直方图显示了第三个级联阶段的IoU分布。
    - 红色数字表示高于相应IoU阈值的正样本百分比：0.7（12.5%）、0.8（7.7%）、0.9（2.7%）。

总结：

- **第一个级联阶段**：IoU分布较为分散，正样本比例较高，尤其是在较低的IoU阈值（0.5）下，正样本比例为30.0%。
- **第二个级联阶段**：IoU分布开始集中，正样本比例有所下降。在IoU阈值为0.6时，正样本比例为17.3%。
- **第三个级联阶段**：IoU分布更加集中，正样本比例进一步下降。在IoU阈值为0.7时，正样本比例为12.5%。

这些直方图展示了随着级联阶段的增加，IoU分布逐渐集中，正样本比例逐渐下降。这表明在更高的级联阶段，检测器的定位精度提高，但正样本的数量减少。通过逐步提高IoU阈值，可以提高检测器的精度，但也会减少正样本的数量。

---

<img width="1410" alt="cascade-rcnn-fig5" src="https://github.com/isLinXu/issues/assets/59380685/38d4fffe-f733-4e90-96b6-22421a76c4ea">
- **Figure 5 (a)**：单独训练的检测器在使用自己的提议时，AP值随着IoU阈值的增加而下降。Cascade R-CNN阶段提议的性能略低于单独训练的检测器。
- **Figure 5 (b)**：通过将真实值添加到提议集中，AP值有所提高，但随着IoU阈值的增加，AP值仍然下降。

---

<img width="682" alt="cascade-rcnn-fig6" src="https://github.com/isLinXu/issues/assets/59380685/e6e499f7-779a-4f75-b9a9-52f2a41e64ec">

- **第1级**：在第1级阶段，AP值随着IoU阈值的增加而下降。不同μ值的AP值差异不大，但μ=0.7的AP值略低。
- **第2级**：在第2级阶段，AP值随着IoU阈值的增加而下降。不同μ值的AP值差异较小，μ=0.5的AP值略高。
- **第3级**：在第3级阶段，AP值随着IoU阈值的增加而下降。不同μ值的AP值差异较小，但μ=0.7的AP值略高。

总体而言，随着级联阶段的增加，AP值有所提高，表明Cascade R-CNN在更高的级联阶段具有更好的检测性能。不同μ值对AP值的影响较小，但在第3级阶段，μ=0.7的AP值略高，表明在更高的级联阶段，较高的μ值可能会带来更好的检测性能。


---
<img width="681" alt="cascade-rcnn-fig7" src="https://github.com/isLinXu/issues/assets/59380685/219e070a-f7b7-43fa-b0f7-76b0dc8fed2a">
(a) Localization Performance

- **Baseline**：定位性能较差，曲线偏离对角线较远。
- **Iterative 1st**：定位性能有所改善，曲线接近对角线。
- **Iterative 3rd**：定位性能进一步改善，曲线更接近对角线。
- **Cascade 1st**：定位性能较好，曲线接近对角线。
- **Cascade 3rd**：定位性能最好，曲线最接近对角线。

(b) Integral Loss

- **μ=0.5**：AP=0.354，随着IoU阈值的增加，AP值逐渐下降。
- **μ=0.6**：AP=0.355，AP值略高于μ=0.5。
- **μ=0.7**：AP=0.337，AP值略低于μ=0.5和μ=0.6。
- **Ensemble**：AP=0.354，AP值与μ=0.5相近。

综合分析：

- **定位性能**：Cascade方法在定位性能上表现优于Iterative方法，尤其是在第3级阶段，Cascade 3rd的定位性能最好，曲线最接近对角线。
- **检测性能**：在Integral Loss检测器中，不同μ值对AP值的影响较小，μ=0.6的AP值略高。Ensemble方法的AP值与μ=0.5相近，表明集成方法在检测性能上没有显著优势。

总体而言，Cascade方法在定位性能上表现更好，而在检测性能上，μ=0.6的AP值略高，表明在Integral Loss检测器中，选择适当的μ值可以略微提高检测性能